# ğŸ“„ models/Notification.js - Ù…Ø¯Ù„ Ù†ÙˆØªÛŒÙÛŒÚ©ÛŒØ´Ù†

## ğŸ“‹ ØªÙˆØ¶ÛŒØ­Ø§Øª Ú©Ù„ÛŒ
Ø§ÛŒÙ† ÙØ§ÛŒÙ„ Schema Ùˆ Model Ù†ÙˆØªÛŒÙÛŒÚ©ÛŒØ´Ù†â€ŒÙ‡Ø§ (Ø§Ø¹Ù„Ø§Ù†â€ŒÙ‡Ø§) Ø±Ø§ ØªØ¹Ø±ÛŒÙ Ù…ÛŒâ€ŒÚ©Ù†Ø¯. Ø¨Ø±Ø§ÛŒ Ø§Ø·Ù„Ø§Ø¹â€ŒØ±Ø³Ø§Ù†ÛŒ Ø±ÙˆÛŒØ¯Ø§Ø¯Ù‡Ø§ÛŒ Ù…Ø®ØªÙ„Ù Ø¨Ù‡ Ú©Ø§Ø±Ø¨Ø±Ø§Ù† Ø§Ø³ØªÙØ§Ø¯Ù‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯.

---

## ğŸ“ ØªØ­Ù„ÛŒÙ„ Ø®Ø· Ø¨Ù‡ Ø®Ø·

### Ø®Ø· 1: import
```javascript
const mongoose = require('mongoose');
```
- ÙˆØ§Ø±Ø¯ Ú©Ø±Ø¯Ù† Mongoose Ø¨Ø±Ø§ÛŒ ØªØ¹Ø±ÛŒÙ Schema

---

### Ø®Ø·ÙˆØ· 3-56: ØªØ¹Ø±ÛŒÙ Schema

```javascript
const notificationSchema = new mongoose.Schema({
    // ÙÛŒÙ„Ø¯Ù‡Ø§...
});
```

---

## ğŸ“Š Ø³Ø§Ø®ØªØ§Ø± ÙÛŒÙ„Ø¯Ù‡Ø§

### ÙÛŒÙ„Ø¯: recipient (Ú¯ÛŒØ±Ù†Ø¯Ù‡)

```javascript
recipient: {
    type: mongoose.Schema.Types.ObjectId,
    ref: 'User',
    required: true
}
```

| ÙˆÛŒÚ˜Ú¯ÛŒ | Ù…Ù‚Ø¯Ø§Ø± | ØªÙˆØ¶ÛŒØ­ |
|-------|-------|-------|
| type | ObjectId | Ø±ÙØ±Ù†Ø³ Ø¨Ù‡ Ù…Ø¯Ù„ User |
| ref | 'User' | Ø¨Ø±Ø§ÛŒ populate |
| required | true | Ø§Ø¬Ø¨Ø§Ø±ÛŒ |

**Ù†Ú©ØªÙ‡:** Ù‡Ø± Ù†ÙˆØªÛŒÙÛŒÚ©ÛŒØ´Ù† Ø¨Ø§ÛŒØ¯ ÛŒÚ© Ú¯ÛŒØ±Ù†Ø¯Ù‡ Ø¯Ø§Ø´ØªÙ‡ Ø¨Ø§Ø´Ø¯.

---

### ÙÛŒÙ„Ø¯: sender (ÙØ±Ø³ØªÙ†Ø¯Ù‡)

```javascript
sender: {
    type: mongoose.Schema.Types.ObjectId,
    ref: 'User'
}
```

**Ù†Ú©ØªÙ‡:** Ø§Ø®ØªÛŒØ§Ø±ÛŒ Ø§Ø³Øª. Ø¨Ø±Ø§ÛŒ Ù†ÙˆØªÛŒÙÛŒÚ©ÛŒØ´Ù†â€ŒÙ‡Ø§ÛŒ Ø³ÛŒØ³ØªÙ…ÛŒ (`system_message`) Ù…ÛŒâ€ŒØªÙˆØ§Ù†Ø¯ null Ø¨Ø§Ø´Ø¯.

---

### ÙÛŒÙ„Ø¯: type (Ù†ÙˆØ¹)

```javascript
type: {
    type: String,
    enum: [
        'reservation_request',
        'reservation_confirmed',
        'reservation_cancelled',
        'reservation_completed',
        'new_review',
        'property_approved',
        'property_rejected',
        'payment_received',
        'payment_refunded',
        'system_message'
    ],
    required: true
}
```

#### Ø¬Ø¯ÙˆÙ„ Ø§Ù†ÙˆØ§Ø¹ Ù†ÙˆØªÛŒÙÛŒÚ©ÛŒØ´Ù†:

| Ù†ÙˆØ¹ | ØªÙˆØ¶ÛŒØ­ | Ú¯ÛŒØ±Ù†Ø¯Ù‡ | ÙØ±Ø³ØªÙ†Ø¯Ù‡ |
|-----|-------|--------|---------|
| `reservation_request` | Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ø±Ø²Ø±Ùˆ Ø¬Ø¯ÛŒØ¯ | Ù…ÛŒØ²Ø¨Ø§Ù† | Ù…Ù‡Ù…Ø§Ù† |
| `reservation_confirmed` | ØªØ£ÛŒÛŒØ¯ Ø±Ø²Ø±Ùˆ | Ù…Ù‡Ù…Ø§Ù† | Ù…ÛŒØ²Ø¨Ø§Ù† |
| `reservation_cancelled` | Ù„ØºÙˆ Ø±Ø²Ø±Ùˆ | Ù…Ù‡Ù…Ø§Ù†/Ù…ÛŒØ²Ø¨Ø§Ù† | Ø·Ø±Ù Ù…Ù‚Ø§Ø¨Ù„ |
| `reservation_completed` | Ø§ØªÙ…Ø§Ù… Ø±Ø²Ø±Ùˆ | Ù‡Ø± Ø¯Ùˆ Ø·Ø±Ù | Ø³ÛŒØ³ØªÙ… |
| `new_review` | Ù†Ø¸Ø± Ø¬Ø¯ÛŒØ¯ | Ù…ÛŒØ²Ø¨Ø§Ù† | Ù…Ù‡Ù…Ø§Ù† |
| `property_approved` | ØªØ£ÛŒÛŒØ¯ Ø§Ù‚Ø§Ù…ØªÚ¯Ø§Ù‡ | Ù…ÛŒØ²Ø¨Ø§Ù† | Ø§Ø¯Ù…ÛŒÙ† |
| `property_rejected` | Ø±Ø¯ Ø§Ù‚Ø§Ù…ØªÚ¯Ø§Ù‡ | Ù…ÛŒØ²Ø¨Ø§Ù† | Ø§Ø¯Ù…ÛŒÙ† |
| `payment_received` | Ù¾Ø±Ø¯Ø§Ø®Øª Ù…ÙˆÙÙ‚ | Ù…ÛŒØ²Ø¨Ø§Ù† | Ø³ÛŒØ³ØªÙ… |
| `payment_refunded` | Ø¨Ø§Ø²Ú¯Ø´Øª ÙˆØ¬Ù‡ | Ù…Ù‡Ù…Ø§Ù† | Ø³ÛŒØ³ØªÙ… |
| `system_message` | Ù¾ÛŒØ§Ù… Ø³ÛŒØ³ØªÙ…ÛŒ | Ú©Ø§Ø±Ø¨Ø± | Ø³ÛŒØ³ØªÙ… |

---

### ÙÛŒÙ„Ø¯Ù‡Ø§ÛŒ: title Ùˆ message

```javascript
title: {
    type: String,
    required: true,
    maxlength: 100
},
message: {
    type: String,
    required: true,
    maxlength: 500
}
```

| ÙÛŒÙ„Ø¯ | Ø­Ø¯Ø§Ú©Ø«Ø± Ø·ÙˆÙ„ | Ø§Ø¬Ø¨Ø§Ø±ÛŒ | Ù…Ø«Ø§Ù„ |
|------|------------|--------|------|
| title | 100 Ú©Ø§Ø±Ø§Ú©ØªØ± | âœ… | "Ø±Ø²Ø±Ùˆ Ø¬Ø¯ÛŒØ¯" |
| message | 500 Ú©Ø§Ø±Ø§Ú©ØªØ± | âœ… | "Ú©Ø§Ø±Ø¨Ø± Ø¹Ù„ÛŒ Ø¨Ø±Ø§ÛŒ ØªØ§Ø±ÛŒØ®..." |

---

### ÙÛŒÙ„Ø¯Ù‡Ø§ÛŒ Ø±ÙØ±Ù†Ø³: relatedProperty Ùˆ relatedReservation

```javascript
relatedProperty: {
    type: mongoose.Schema.Types.ObjectId,
    ref: 'Property'
},
relatedReservation: {
    type: mongoose.Schema.Types.ObjectId,
    ref: 'Reservation'
}
```

**Ú©Ø§Ø±Ø¨Ø±Ø¯:**
- Ù„ÛŒÙ†Ú© Ù…Ø³ØªÙ‚ÛŒÙ… Ø¨Ù‡ Ø§Ù‚Ø§Ù…ØªÚ¯Ø§Ù‡ ÛŒØ§ Ø±Ø²Ø±Ùˆ Ù…Ø±ØªØ¨Ø·
- Ø¨Ø±Ø§ÛŒ Ù†Ù…Ø§ÛŒØ´ Ø¬Ø²Ø¦ÛŒØ§Øª Ø¯Ø± ÙØ±Ø§Ù†Øªâ€ŒØ§Ù†Ø¯
- Ø§Ø®ØªÛŒØ§Ø±ÛŒ Ù‡Ø³ØªÙ†Ø¯

---

### ÙÛŒÙ„Ø¯Ù‡Ø§ÛŒ ÙˆØ¶Ø¹ÛŒØª Ø®ÙˆØ§Ù†Ø¯Ù‡ Ø´Ø¯Ù†

```javascript
isRead: {
    type: Boolean,
    default: false
},
readAt: {
    type: Date
}
```

| ÙÛŒÙ„Ø¯ | Ù†ÙˆØ¹ | Ù¾ÛŒØ´â€ŒÙØ±Ø¶ | ØªÙˆØ¶ÛŒØ­ |
|------|-----|---------|-------|
| isRead | Boolean | false | Ø¢ÛŒØ§ Ø®ÙˆØ§Ù†Ø¯Ù‡ Ø´Ø¯Ù‡ØŸ |
| readAt | Date | - | Ø²Ù…Ø§Ù† Ø®ÙˆØ§Ù†Ø¯Ù† |

---

### ÙÛŒÙ„Ø¯: createdAt

```javascript
createdAt: {
    type: Date,
    default: Date.now
}
```

---

## ğŸ—‚ï¸ Index

```javascript
notificationSchema.index({ recipient: 1, isRead: 1, createdAt: -1 });
```

**ØªÙˆØ¶ÛŒØ­:**
- Composite Index Ø±ÙˆÛŒ Ø³Ù‡ ÙÛŒÙ„Ø¯
- `recipient: 1` â†’ ØµØ¹ÙˆØ¯ÛŒ
- `isRead: 1` â†’ ØµØ¹ÙˆØ¯ÛŒ
- `createdAt: -1` â†’ Ù†Ø²ÙˆÙ„ÛŒ (Ø¬Ø¯ÛŒØ¯ØªØ±ÛŒÙ† Ø§ÙˆÙ„)

**Query Ø¨Ù‡ÛŒÙ†Ù‡ Ø´Ø¯Ù‡:**
```javascript
// Ø§ÛŒÙ† query Ø§Ø² Index Ø§Ø³ØªÙØ§Ø¯Ù‡ Ù…ÛŒâ€ŒÚ©Ù†Ø¯
Notification.find({ 
    recipient: userId, 
    isRead: false 
}).sort({ createdAt: -1 });
```

---

## ğŸ“ Ù…Ø«Ø§Ù„ Document

```json
{
    "_id": "65not123...",
    "recipient": "65user456...",
    "sender": "65admin789...",
    "type": "reservation_confirmed",
    "title": "Ø±Ø²Ø±Ùˆ Ø´Ù…Ø§ ØªØ£ÛŒÛŒØ¯ Ø´Ø¯",
    "message": "Ø±Ø²Ø±Ùˆ Ø´Ù…Ø§ Ø¨Ø±Ø§ÛŒ ÙˆÛŒÙ„Ø§ÛŒ Ø³Ø§Ø­Ù„ÛŒ Ø¯Ø± ØªØ§Ø±ÛŒØ® 1403/12/25 ØªØ£ÛŒÛŒØ¯ Ø´Ø¯.",
    "relatedProperty": "65prop111...",
    "relatedReservation": "65res222...",
    "isRead": false,
    "readAt": null,
    "createdAt": "2026-03-10T10:00:00.000Z"
}
```

---

## ğŸ§ª Ù…Ø«Ø§Ù„â€ŒÙ‡Ø§ÛŒ Ø§Ø³ØªÙØ§Ø¯Ù‡

### Ø§ÛŒØ¬Ø§Ø¯ Ù†ÙˆØªÛŒÙÛŒÚ©ÛŒØ´Ù† Ø±Ø²Ø±Ùˆ
```javascript
await Notification.create({
    recipient: hostId,
    sender: guestId,
    type: 'reservation_request',
    title: 'Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ø±Ø²Ø±Ùˆ Ø¬Ø¯ÛŒØ¯',
    message: `${guestName} Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ø±Ø²Ø±Ùˆ Ø¨Ø±Ø§ÛŒ ${propertyTitle} Ø¯Ø§Ø±Ø¯.`,
    relatedProperty: propertyId,
    relatedReservation: reservationId
});
```

### Ø§ÛŒØ¬Ø§Ø¯ Ù†ÙˆØªÛŒÙÛŒÚ©ÛŒØ´Ù† Ø³ÛŒØ³ØªÙ…ÛŒ
```javascript
await Notification.create({
    recipient: userId,
    type: 'system_message',
    title: 'Ø®ÙˆØ´ Ø¢Ù…Ø¯ÛŒØ¯!',
    message: 'Ø¨Ù‡ StayLocal Ø®ÙˆØ´ Ø¢Ù…Ø¯ÛŒØ¯. Ø¨Ø±Ø§ÛŒ Ø´Ø±ÙˆØ¹ ÛŒÚ© Ø§Ù‚Ø§Ù…ØªÚ¯Ø§Ù‡ Ø§Ø¶Ø§ÙÙ‡ Ú©Ù†ÛŒØ¯.'
});
```

### Ø¯Ø±ÛŒØ§ÙØª Ù†ÙˆØªÛŒÙÛŒÚ©ÛŒØ´Ù†â€ŒÙ‡Ø§ÛŒ Ø®ÙˆØ§Ù†Ø¯Ù‡ Ù†Ø´Ø¯Ù‡
```javascript
const unread = await Notification.find({
    recipient: req.user.id,
    isRead: false
}).sort({ createdAt: -1 });
```

### Ø¹Ù„Ø§Ù…Øªâ€ŒÚ¯Ø°Ø§Ø±ÛŒ Ø¨Ù‡ Ø¹Ù†ÙˆØ§Ù† Ø®ÙˆØ§Ù†Ø¯Ù‡ Ø´Ø¯Ù‡
```javascript
await Notification.findByIdAndUpdate(notificationId, {
    isRead: true,
    readAt: new Date()
});
```

### Ø¹Ù„Ø§Ù…Øªâ€ŒÚ¯Ø°Ø§Ø±ÛŒ Ù‡Ù…Ù‡ Ø¨Ù‡ Ø¹Ù†ÙˆØ§Ù† Ø®ÙˆØ§Ù†Ø¯Ù‡ Ø´Ø¯Ù‡
```javascript
await Notification.updateMany(
    { recipient: req.user.id, isRead: false },
    { isRead: true, readAt: new Date() }
);
```

### Ø´Ù…Ø§Ø±Ø´ Ø®ÙˆØ§Ù†Ø¯Ù‡ Ù†Ø´Ø¯Ù‡â€ŒÙ‡Ø§
```javascript
const unreadCount = await Notification.countDocuments({
    recipient: req.user.id,
    isRead: false
});
```

---

## ğŸ”„ Ø¬Ø±ÛŒØ§Ù† Ù†ÙˆØªÛŒÙÛŒÚ©ÛŒØ´Ù†

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Ø±ÙˆÛŒØ¯Ø§Ø¯ Ø§ØªÙØ§Ù‚ Ù…ÛŒâ€ŒØ§ÙØªØ¯                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            Notification.create() ÙØ±Ø§Ø®ÙˆØ§Ù†ÛŒ Ù…ÛŒâ€ŒØ´ÙˆØ¯             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Ø°Ø®ÛŒØ±Ù‡ Ø¯Ø± MongoDB                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     ÙØ±Ø§Ù†Øªâ€ŒØ§Ù†Ø¯ polling Ù…ÛŒâ€ŒÚ©Ù†Ø¯: GET /api/notifications        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          Ù†Ù…Ø§ÛŒØ´ Ø¯Ø± UI (Ø¢ÛŒÚ©ÙˆÙ† Ø²Ù†Ú¯ + Ø´Ù…Ø§Ø±Ù†Ø¯Ù‡)                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```
